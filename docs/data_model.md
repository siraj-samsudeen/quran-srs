## Conventions

- All tables will have an autogenerated primary key called `id`.
- Table names are in plural e.g. users, hafizs
- Foreign keys are in the format - user_id, hafiz_id

## Tables

### User Management

The system separates users (account holders) from hafizs (memorizers) to support complex family and educational scenarios:

- A single user might have more than 1 hafiz under him/her. For example, Fatima has 3 hafiz accounts for her memorising children and one for herself.
- Zainab, the teenage daughter of Fatima, has independent access to her account with her own login - but she can access data of her sibling as well.
- Both parents might need access to a child's account
- To enable all these scenarios, users and hafizs tables are individual tables with the many-to-many relationship stored in an association table hafizs_users


#### users table
Account holders who can log in and access the system.

- name
- email: Unique across the system, used for authentication and notifications
- password: Encrypted password for login
- role: Primary role of the user. Values: hafiz, parent, teacher, parent_hafiz

#### hafizs table
Individual memorizers whose progress is tracked, regardless of who manages their account.

- name
- daily_capacity: How many pages they can revise per day - upper limit for suggested revision plan
- effective_date: rather than using the actual date when a revision entry is recorded, this date will used as the default to allow the hafiz to enter the revision data even after the day is technically over. A day close feature is used to allow hafiz to close one day and move to the next day. 
- bulk_entry_page_count: The default number of pages to display in bulk entry pages (default: 5)

#### hafizs_users table
Defines which users can access which hafiz accounts and their relationship.

- hafiz_id
- user_id
- relationship: How user relates to hafiz. Values: self, parent, teacher, sibling

### Quran Content Structure

#### mushafs table
Different versions/editions of the Quran with their layout specifications.

- name: e.g. "Madinah Mushaf", "Uthmani Script"
- description
- total_pages
- lines_per_page

#### surahs table
Surahs of the Quran.

- number: Surah number in the Quran. Values: 1-114
- name: e.g. Maryam, Taha

#### pages table
Individual pages within a mushaf as different mushafs might have different surahs on a given page.

- mushaf_id
- page_number: Sequential page number e.g. 471
- juz_number: Which juz this page belongs to e.g. 13. Values: 1-30
- start_text: First 3 words of the page e.g. `الْحَمْدُ لِلَّهِ رَبِّ`

#### items table
The unit for revision entries. 
Ideally, if every page had only 1 surah, an item would equal a page and there would be no need for a separate item table. 
The need arises because some pages contain more than 1 surah - hence we create page-parts to track those parts. 
In addition, we want to enable a 1.5 page surah to be tracked as a single item.

- item_type: Type of memorizable unit. Values: page, page-part, surah
- surah_id
- page_id
- part: Text to indicate which part e.g. Part 1, Top part
- active: to enable/disable certain items globally
- description

### Revision Management 

#### modes table
Different modes of memorization practice (e.g., New Memorization, Daily, Weekly, Full Cycle, SRS).

- name
- description

#### hafizs_items table
Memorization status for each item for each hafiz. Also used to store item level statistics for each hafiz. 

- hafiz_id
- item_id
- status: Values: memorized, newly_memorized, not_memorized
- mode_id
- last_review: Date when this item was last reviewed
- next_review: Date when this item should be reviewed next
- watch_list_graduation_date: Date when item graduated from watch list
- srs_booster_pack_id
- good_streak: Count of consecutive successful reviews
- bad_streak: Count of consecutive failed reviews
- last_interval: Previous planned interval duration in days 
- current_interval: Actual interval duration in days
- next_interval: Calculated interval for next review in days
- srs_start_date: Date when SRS tracking began for this item
- good_count: Total count of successful reviews
- bad_count: Total count of failed reviews
- score: Sum of the ratings
- count: Total number of reviews for this item


#### full_cycles table
here we capture the data about the pages covered in each full cycle of revision through all the memorized pages. 

- hafiz_id
- number: current cycle number. starts at 1 and keeps going
- start_date
- end_date
- start_page
- end_page
- page_count: Total number of pages revised in the cycle
- completed: Boolean



#### revisions table
Individual revision sessions and their outcomes.

- hafiz_id
- item_id
- revision_date: Date when revision took place
- rating: Performance rating for this revision
  - values: -1(Bad), 0(Ok), 1(Bad)
- mode_id
- full_cycle_id
<!-- - notes: Additional notes about the revision session -->
- last_interval: Previous planned interval duration in days
- current_interval: Actual interval duration in days
- next_interval: Calculated interval for next revision in days

